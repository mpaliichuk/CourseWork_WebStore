@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor

@{
    var session = HttpContextAccessor.HttpContext.Session;
    var userName = session.GetString("UserName");
    var email = session.GetString("Email");
    var role = session.GetString("Role");
    var userId = session.GetInt32("UserId");
}

    
<div class="container" style="padding-top:10%">
    <div class="row">
        <div class="col-md-3">
            <div class="filters">
                <div class="left-panel">
                    <h3>Categories</h3>
                    <ul class="list-group" style="margin-bottom: 20px;">
                        <li class="list-group-item"><a href="#" class="nav-link text-dark" data-category="">All</a></li>
                        @foreach (var category in ViewBag.Categories)
                        {
                            <li class="list-group-item"><a href="#" class="nav-link text-dark" data-category="@category.Name">@category.Name</a></li>
                        }
                    </ul>
                </div>
                <div class="right-panel">
                    <form id="filterForm" asp-action="Index" asp-controller="Home" method="get">
                        <input type="hidden" id="categoryFilter" name="categoryName" />
                        <input type="text" id="productName" name="productName" placeholder="Search by name" class="form-control mb-2" /> <!-- New input field for searching by product name -->
                        <button type="submit" id="applyFilterButton" class="btn btn-primary btn-block">Search</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-9">
            <div class="text-center">
                @if (!string.IsNullOrEmpty(userName))
                {
                    <h1>Welcome, @userName</h1>
                    @*<h2>Email: @email</h2>
                        <h2>Role: @role</h2>
                        @if (userId.HasValue)
                        {
                            <h2>User ID: @userId</h2>
                        }
                        <text>
                            <a asp-action="Logout" asp-controller="Account" class="btn btn-danger">Log out</a>
                        </text>*@
                }
                else
                {
                    <h2>Welcome, Guest</h2>
                    @*<p>Learn about <a href="https://docs.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>*@
                }
            </div>



            <section id="mobile-products" class="product-store position-relative padding-large no-padding-top">
                <div class="container" style="padding-top:10%">
                    <div class="row">
                        <div class="display-header d-flex justify-content-between pb-3">
                            <h2 class="display-7 text-dark text-uppercase">Products</h2>
                        </div>
                        <div class="swiper product-swiper swiper-initialized swiper-horizontal swiper-backface-hidden">
                            <div class="swiper-wrapper" id="swiper-wrapper" aria-live="polite">
                                @foreach (var product in Model)
                                {
                                    <div class="swiper-slide" role="group" aria-label="3 / 5" style="width: 225px; margin-right: 20px;">
                                        <div class="product-card position-relative">
                                            <div class="image-holder">
                                                @if (!string.IsNullOrEmpty(product.PictureUrl))
                                                {
                                                    <img src="@product.PictureUrl" alt="@product.Name" alt="product-item" class="img-fluid" />
                                                }
                                            </div>
                                            <div class="cart-concern position-absolute">
                                                <div class="cart-button d-flex">
                                                    <form asp-controller="Order" asp-action="CreateOrder" method="post">
                                                        <input type="hidden" name="userId" value="@userId" />
                                                        <input type="hidden" name="productId" value="@product.ProductId" />
                                                        <div class="form-group">
                                                            <label for="quantity" style="color:green">Quantity:</label>
                                                            <input type="number" id="quantity" name="quantity" value="1" min="1" style="width: 20%;" />
                                                            <button href="#" class="btn btn-medium btn-black" type="submit">Add to Cart<svg class="cart-outline"><use xlink:href="#cart-outline"></use></svg></button>
                                                        </div>
                                                    </form>

                                                </div>
                                            </div>
                                            <div class="card-detail d-flex justify-content-between align-items-baseline pt-3">
                                                <h3 class="card-title text-uppercase">
                                                    <a href="#">@product.Name</a>
                                                </h3>
                                                <span class="item-price text-primary">Price: $@product.Price</span>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                            <span class="swiper-notification" aria-live="assertive" aria-atomic="true"></span>
                        </div>
                    </div>
                </div>
            </section>

            <script>document.addEventListener('DOMContentLoaded', function () {
                    var categoryLinks = document.querySelectorAll('.category-link');

                    categoryLinks.forEach(function (link) {
                        link.addEventListener('click', function (event) {
                            event.preventDefault();
                            var category = this.getAttribute('data-category');
                            document.getElementById('categoryFilter').value = category;
                            document.getElementById('filterForm').submit();
                        });
                    });
                });</script>
