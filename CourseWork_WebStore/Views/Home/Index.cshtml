@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor

@{
    var session = HttpContextAccessor.HttpContext.Session;
    var userName = session.GetString("UserName");
    var email = session.GetString("Email");
    var role = session.GetString("Role");
    var userId = session.GetInt32("UserId");
}

<div class="text-center">
    @if (!string.IsNullOrEmpty(userName))
    {
        <h1>Welcome, @userName</h1>
        <h2>Email: @email</h2>
        <h2>Role: @role</h2>
        @if (userId.HasValue)
        {
            <h2>User ID: @userId</h2>
        }
        <text>
            <a asp-action="Logout" asp-controller="Account">Log out</a>
        </text>
    }
    else
    {
        <h2>Welcome, Guest</h2>
        @*<p>Learn about <a href="https://docs.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>*@
    }
</div>

<div class="filters">
    <form id="filterForm" asp-action="Index" asp-controller="Home" method="get">
        <select id="categorySelect" name="categoryName">
            <option value="">All Categories</option>
            @foreach (var category in ViewBag.Categories)
            {
                <option value="@category.Name">@category.Name</option>
            }
        </select>
        <button type="submit" id="applyFilterButton">Apply Filter</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var filterForm = document.getElementById('filterForm');
        var categorySelect = document.getElementById('categorySelect');
        document.getElementById('applyFilterButton').addEventListener('click', function (event) {
            event.preventDefault();
            if (categorySelect.value !== '') {
                filterForm.submit();
            }
        });
    });
</script>
<div class="product-grid">
    <div class="row">
        @foreach (var product in Model)
        {
            <div class="col-md-4">
                <div class="product-box">
                    <h3>@product.Name</h3>
                    <p>@product.Description</p>
                    <p>Price: $@product.Price</p>
                    <p>Stock: @product.Stock</p>
                    <form asp-controller="Order" asp-action="CreateOrder" method="post">
                        <input type="hidden" name="userId" value="@userId" />
                        <input type="hidden" name="productId" value="@product.ProductId" />
                        <div class="form-group">
                            <label for="quantity">Quantity:</label>
                            <input type="number" id="quantity" name="quantity" value="1" min="1" />
                        </div>
                        <button type="submit" class="btn btn-primary">Add to Cart</button>
                    </form>
                </div>
            </div>
        }
    </div>
</div>
